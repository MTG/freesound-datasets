{% block page_js %}
    <script type="text/javascript">

        $("#s{{ freesound_id }}").ready(function () {

            // Create color map for spectrogram
            /*
            var spectrogramColorMap = colormap({
                colormap: magma,
                nshades: 256,
                format: 'rgb',
                alpha: 1
            });
            */
            var freesound_id = "{{ freesound_id }}";
            var player_container = "#s" + freesound_id;

            var waveform_url = "{{ waveform_url }}";
            var spectrogram_url = "{{ spectrogram_url }}";

            var height = 64;
            var height_px = height + "px";
            var ws_container = player_container + " .wavesurfer";
            var wavesurfer = Object.create(WaveSurfer);
            wavesurfer.init({
                container: ws_container,
                height: height
            });

            $(ws_container).find(".spectrogram").css({
                "height": height_px,
                "background-image": "url(" + spectrogram_url + ")",
                "background-repeat": "no-repeat",
                "background-size": "100% 100%"
            });

            $(ws_container).find(".waveform").css({
                "height": height_px,
                "background-image": "url(" + waveform_url + ")",
                "background-repeat": "no-repeat",
                "background-size": "100% 100%"
            });

            wavesurfer.on('ready', function () {

                $(ws_container).children("wave").css({
                    "width": "100%",
                    "overflow": "hidden"
                });

                var controls_container = $(player_container + " .controls");
                var play_pause = $(player_container + " .controls .play_pause");

                play_pause.click(function() {
                    wavesurfer.playPause();
                    play_pause.children(".icon").toggle();
                });

                $(player_container + " .controls .stop").click(function() {
                    wavesurfer.stop();
                });

                $(player_container + " .controls .switch").click(function() {
                    $(player_container + " .wavesurfer .waveform").toggle();
                    $(player_container + " .wavesurfer .spectrogram").toggle();
                });
            });

            wavesurfer.load('{{ sound_url }}');
        });
    </script>
{% endblock %}

<div class="soundplayer" id="s{{ freesound_id }}">
    <div class="wavesurfer">
        <div class="spectrogram"></div>
        <div class="waveform"></div>
    </div>
    <div class="ui horizontal buttons controls">
        <button class="ui icon blue button play_pause">
            <i class="play icon"></i>
            <i class="pause icon" style="display: none;"></i>
        </button>

        <button class="ui icon blue button step_back">
            <i class="stop icon"></i>
        </button>

        <button class="ui red button switch">
            Switch view
        </button>
    </div>
</div>




