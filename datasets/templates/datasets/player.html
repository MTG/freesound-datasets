{% block page_js %}
    <script type="text/javascript">
        $('#waveform_{{ freesound_id }}').ready(function () {

            // Create color map for spectrogram
            var spectrogramColorMap = colormap({
                colormap: magma,
                nshades: 256,
                format: 'rgb',
                alpha: 1
            });

            var height = 64;
            var wavesurfer = Object.create(WaveSurfer);
            wavesurfer.init({
                container: "#s{{ freesound_id }} .audio_visual",
                waveColor: '#FF00FF',
                progressColor: '#000000',
                height: height
            });

            wavesurfer.on('ready', function () {

                $("#s{{ freesound_id }} .audio_visual wave").css({
                    width: "100%",
                    overflow: "hidden"
                });

                var spectrogram = Object.create(WaveSurfer.Spectrogram);
                spectrogram.init({
                    wavesurfer: wavesurfer,
                    container: "#s{{ freesound_id }} .audio_visual .spectrogram",
                    // For the spectrogram the height is half the number of fftSamples
                    fftSamples: height * 2,
                    height: height,
                    colorMap: spectrogramColorMap
                });

                $("#s{{ freesound_id }} .controls .play_pause").click(function() {
                    wavesurfer.playPause();
                });

                $("#s{{ freesound_id }} .controls .stop").click(function() {
                    wavesurfer.stop();
                });

                $("#s{{ freesound_id }} .controls .switch").click(function() {
                    $("#s{{ freesound_id }} .audio_visual wave").toggle();
                    $("#s{{ freesound_id }} .audio_visual spectrogram").toggle();
                });
            });

            // Create hiddenImage, an image that is slowly revealed to a user as they annotate#}
            // (only for this.currentTask.feedback === 'hiddenImage')
            /*
            var hiddenImage = new HiddenImg('.hidden_img', 100);
            hiddenImage.create();
            */
            wavesurfer.load('{{ sound_url }}');
        });
    </script>
{% endblock %}

<div class="soundplayer" id="s{{ freesound_id }}">
    <a href="{{ spectrogram_url }}">View spectrogram</a>
    <div class="audio_visual">
        <div class="spectrogram"></div>
    </div>
    <div class="ui horizontal buttons controls">
        <button class="ui icon blue button play_pause">
            <i class="play icon"></i>
            <i class="pause icon" style="display: none;"></i>
        </button>

        <button class="ui icon blue button stop">
            <i class="stop icon"></i>
        </button>

        <button class="ui red button switch">
            Switch view
        </button>
    </div>
</div>
