{% block page_js %}
    <script type="text/javascript">
        $('#waveform_{{ freesound_id }}').ready(function () {

            // Create color map for spectrogram
            /*
            var spectrogramColorMap = colormap({
                colormap: magma,
                nshades: 256,
                format: 'rgb',
                alpha: 1
            });
            */

            var height = 64;
            var wavesurfer = Object.create(WaveSurfer);
            wavesurfer.init({
                container: "#s{{ freesound_id }} .wavesurfer",
                //waveColor: '#000000',
                //progressColor: '#FF0000',
                height: height
            });

            //$("#s{{ freesound_id }} .audio_visual wave").hide();
            $("#s{{ freesound_id }} .audio_visual .waveform").hide();

                /*
                var spectrogram = Object.create(WaveSurfer.Spectrogram);
                spectrogram.init({
                    wavesurfer: wavesurfer,
                    container: "#s{{ freesound_id }} .audio_visual .spectrogram",
                    // For the spectrogram the height is half the number of fftSamples
                    fftSamples: height * 2,
                    height: height,
                    colorMap: spectrogramColorMap
                });
                */

            wavesurfer.on('ready', function () {

                $("#s{{ freesound_id }} .wavesurfer wave").css({
                    "background-image": "url({{ waveform_url }})",
                    "background-repeat": "no-repeat",
                    "background-size": "100% 100%",
                    "width": "100%",
                    "overflow": "hidden"
                });

                $("#s{{ freesound_id }} .controls .play_pause").click(function() {
                    wavesurfer.playPause();
                });

                $("#s{{ freesound_id }} .controls .stop").click(function() {
                    wavesurfer.stop();
                });

                $("#s{{ freesound_id }} .controls .switch").click(function() {
                    //$("#s{{ freesound_id }} .audio_visual wave").toggle();
                    $("#s{{ freesound_id }} .audio_visual .waveform").toggle();
                    $("#s{{ freesound_id }} .audio_visual .spectrogram").toggle();
                });
            });

            // Create hiddenImage, an image that is slowly revealed to a user as they annotate
            // (only for this.currentTask.feedback === 'hiddenImage')
            /*
            var hiddenImage = new HiddenImg('.hidden_img', 100);
            hiddenImage.create();
            */
            wavesurfer.load('{{ sound_url }}');
        });
    </script>
{% endblock %}

<div class="soundplayer" id="s{{ freesound_id }}">
    <div class="wavesurfer"></div>
    <div class="audio_visual">
        <div class="spectrogram">
            <img src="{{ spectrogram_url }}" height="64" width="100%"/>
        </div>
        <div class="waveform" style="display: none;">
            <img src="{{ waveform_url }}" height="64" width="100%"/>
        </div>
    </div>
    <div class="ui horizontal buttons controls">
        <button class="ui icon blue button play_pause">
            <i class="play icon"></i>
            <i class="pause icon" style="display: none;"></i>
        </button>

        <button class="ui icon blue button stop">
            <i class="stop icon"></i>
        </button>

        <button class="ui red button switch">
            Switch view
        </button>
    </div>
</div>




