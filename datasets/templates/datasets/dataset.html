{% extends "base.html" %}
{% load staticfiles %}
{% load humanize %}
{% load dataset_templatetags %}
{% block title %}{{dataset.short_name|upper}}{% endblock title %}
{% block page_js %}

    <script type="text/javascript">
        $(document).ready(function() {
            loadDatasetReleasesTable();
            {% if dataset_release_form_errors %}
                $('#make_release_modal').modal('show');
            {% endif %}
            $('.menu .item').tab();
            start_auto_scroll();
        });

        function loadDatasetReleasesTable() {
            $( "#dataset_releases_table_placeholder" ).load( "{% url 'releases-table' dataset.short_name %}", function() {
                {% if user_is_maintainer %}
                    startUpdatingPercentages();
                {% endif %}
            });
        }

        function updateReleasePercentages() {
            n_polling_checks += 1;
            $.get( "{% url 'check-release-progresses' dataset.short_name %}", function( data ) {

                // First check if there is any data returned, if not stop the polling (no releases)
                if ($.isEmptyObject(data)){
                    window.clearInterval(polling_timer);
                    polling_timer = undefined;
                    n_polling_checks = 0;
                    return;
                }

                // First check if all releases are complete
                var allComplete = true;
                for (var key in data) {
                    if (data.hasOwnProperty(key)) {
                        if (data[key] != 100) {
                            allComplete = false;
                        }
                    }
                }

                // If all releases are complete at first check, there is no progress to track, cancel timer
                if (allComplete && n_polling_checks === 1){
                    window.clearInterval(polling_timer);
                    polling_timer = undefined;
                    n_polling_checks = 0;
                } else {
                    if (allComplete && n_polling_checks > 1){
                        // If all are complete and we checked more than once, this means that those which
                        // were progressing have now finished
                        loadDatasetReleasesTable();
                        n_polling_checks = 0;
                    }
                    // If not all are complete or we're at later polling check, update progress bars
                    for (var key in data) {
                        if (data.hasOwnProperty(key)) {
                            $('#release_percentage_bar_' + key).progress({
                                percent: data[key],
                                text: {active: '{percent}%'}
                            });
                        }
                    }
                }
            });
        }

        var polling_timer = undefined;
        var n_polling_checks = 0;
        function startUpdatingPercentages(){
            if (polling_timer === undefined) {
                polling_timer = setInterval(function(){ updateReleasePercentages(); }, 1000);
            }
        }

        function start_auto_scroll() {
            var translate_values = ['-25', '-322', '-621', '-920', '-1217', '-1515', '-1811', '-2109', '-2407', '-2705'];
            var counter = 1;
            $('#examples_container').css({"transform": "translateX(-25px)"});
            var paused = false;
            $('#category_examples').on({
                mouseenter: function () {
                    paused = true;
                },
                mouseleave: function () {
                    paused = false;
                }
            });
            setInterval(function() {
                if (!paused) {
                    var translate_value = translate_values[counter];
                    $('#examples_container').css({"transform": "translateX(" + translate_value + "px)"});
                    counter = (counter < 9) ? counter + 1 : 0;
                }
            }, 5000)

        }
    </script>
{% endblock %}
{% block content %}


<!--new proposed version**********************************************************************************-->

<center>

<h2 style="color: black;">{{ dataset.short_name|upper }} is a large-scale, general-purpose audio dataset</h2>
        <p style="margin-top:0px">Thousands of audio samples from <a target="_blank" href="http://freesound.org/"><b>Freesound.org</b></a> organised following the <a target="_blank" href="https://research.google.com/audioset/"><b>AudioSet Ontology</b></a></p>

<br>

  <div class="ui container" style="width:95%;">
    <div class="ui middle aligned stackable grid container">
      <div class="row">
        <div class="right floated left aligned nine wide column">
          <h3 class="ui header">{{ dataset.short_name|upper }}: a dataset of everyday sounds</h3>
          <p style="text-align:justify">The AudioSet Ontology is a hierarchical collection of over 600 sound classes and
              we have filled them with {{ dataset.num_sounds|intcomma }} audio samples from Freesound.org.
              This process generated {{ dataset.num_annotations|intcomma }} candidate annotations
that express the presence of sound sources in audio clips.
          {{ dataset.short_name|upper }}  includes a variety of everyday sounds, from human and animal sounds to music and sounds made by things,
              all under Creative Commons licenses.
          </p>
        </div>
        <div class="six wide right floated column">
              <div class="ui basic segment ">
          <img class="ui center aligned image" style="width: 270px;padding: 0px 20px 3px 20px;" src="{% static "img/freesound_logo_color.png" %}">
          <img class="ui center aligned image" style="width: 270px;padding: 10px 20px 10px 20px;" src="{% static "img/audioset_logo_blue.svg" %}">
          </div>
        </div>
      </div>
    </div>
  </div>

<br><br>

<div class="ui center aligned ">

<div class="ui grid">

<div class="twelve wide column"><h2>Our goals</h2>
 <br>
 <div class="ui three statistics">
  <div class="ui blue statistic">
    <div class="value">
      +600k
    </div>
    <div class="label">
      annotations
    </div>
  </div>
  <div class="ui blue statistic">
    <div class="value">
      +260k
    </div>
    <div class="label">
      audio samples
    </div>
  </div>
   <div class="ui blue statistic">
    <div class="label">
      improving
    </div>
    <div class="text value">
      quantity <br>& quality
    </div>
  </div>
 </div>
</div>
<div class="four wide column"><h2>Currently</h2>
 <br>
 <div class="ui one statistics">
  <div class="ui blue statistic">
    <div class="value">
      {{ dataset.percentage_verified_annotations|floatformat:1 }}%
    </div>
    <div class="label">
      annotations<br> verified
    </div>
  </div>
 </div>
</div>

</div>
<br>
</div>
<br>


  <div class="ui container" style="width:95%;">
    <div class="ui middle aligned stackable grid container">
      <div class="row">
        <div id="category_examples" class="six wide right floated column" style="overflow-x: hidden;">
          <div id="examples_container" style="width: 3000px; transition: transform 1s ease;">
            {% for node in random_nodes %}
              <span class="ui segment" id="node_{{ forloop.counter }}" style="display: inline-block; width:294px;">
              <div><p><b>{{ node.name }}</b></p></div>
              <div>
                {% for sound in node.valid_examples %}
                  <span>
                    {{ sound| fs_embed | safe }}
                  </span>
                {% endfor %}
              </div>
              </span>
            {% endfor %}
          </div>
        </div>
        <div class="right floated left aligned nine wide column">
          <h3 class="ui header">Crowdsourcing annotations</h3>
          <p style="text-align:justify">By creating this dataset, we hope to promote research to enable machines to hear
              and interpret similarly to humans.
          In order to make {{ dataset.short_name|upper}} reliable enough for research, we need to verify the generated annotations.
              To do so, we are now crowdsourcing annotations to build the first {{ dataset.short_name|upper }} release. Wanna contribute? :)

          </p>
        </div>
      </div>
    </div>
  </div>


<br>

<br>

<div class="ui steps raised" style="text-align:left;">

  <div class="step">
    <i class="checkmark grey icon"></i>
    <div class="content">
      <div class="title">Generate annotations</div>
      <div class="description">already done automatically</div>
    </div>
  </div>

  <div class="active step">
    <i class="users  icon"></i>
    <div class="content">
      <div class="title"><a target="_blank" href="{% url 'contribute' dataset.short_name %}"><b>Crowdsourcing</b></a></div>
      <div class="description">help us <a target="_blank" href="{% url 'contribute' dataset.short_name %}"><b>verify the <br> candidate annotations</b></a></div>
    </div>
  </div>

  <div class="disabled step">
    <i class="send icon"></i>
    <div class="content">
      <div class="title">First {{ dataset.short_name|upper }} release</div>
      <div class="description">including waveforms, audio features, <br> metadata and annotations</div>
    </div>
  </div>

</div>

<br>




<br>

<!--<div class="ui vertical segment center aligned">-->
<div class="ui vertical segment center aligned ">

<h2> Get involved and start contributing!</h2>
<center>
<div class="ui basic labels" style="margin-top:25px;border: 0px solid;">

  <a class="ui basic label" href="{% url 'dataset-explore' dataset.short_name %}" style="min-width: 200px;border: 0px solid;">
      <center><h3>Explore</h3>
      <i class="unhide icon huge"></i><br><br>
      <p>Take a peek <br> inside {{ dataset.short_name|upper }}</p></center>
    </a>

  <a class="ui basic label" href="{% url 'contribute' dataset.short_name %}" style="min-width: 200px;border: 0px solid;">
      <center><h3>Annotate</h3>
      <i class="child icon huge"></i><br><br>
      <p>Help us verify the<br> candidate annotations</p></center>
    </a>

  <a class="ui basic label" href="{% url 'discussion' dataset.short_name %}" style="min-width: 200px;border: 0px solid;">
      <center><h3>Discuss</h3>
      <i class="comments outline icon huge"></i><br><br>
      <p>Share your comments<br>and suggestions</p></center>
    </a>
</div>
</center>
<br>
</div>

<br><br><br>

<div class="ui main center aligned container stackable" style="margin-top: 30px; margin-bottom:-30px;">
<p  style="margin-bottom: 0px;"> If you use this platform or any of the hosted datasets in academic work please cite our paper: </p>
 E. Fonseca, J. Pons, X. Favory, F. Font, D. Bogdanov, A. Ferraro, S. Oramas, A. Porter & X. Serra.
    <a target="_blank" href="https://ismir2017.smcnus.org/wp-content/uploads/2017/10/161_Paper.pdf"><br>
        Freesound Datasets: A Platform for the Creation of Open Audio Datasets</a>. <br>
    In Proceedings of the 18th International Society for Music Information Retrieval Conference, Suzhou, China, 2017. <b>[BiB]</b>
</div>


</center>
<!--end of new proposed version-->


<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>









<!--second version**********************************************************************************-->


<center>
<h2 style="color: black;">The {{ dataset.short_name|upper }} is a large-scale, general-purpose audio dataset</h2>
        <p style="margin-top:0px">It consists of audio samples from <a target="_blank" href="http://freesound.org/"><b>Freesound.org</b></a> organised following the <a target="_blank" href="https://research.google.com/audioset/"><b>AudioSet Ontology</b></a></p>

<br>

  <div class="ui container" style="width:80%;">
    <div class="ui middle aligned stackable grid container">
      <div class="row">
        <div class="six wide right floated column">
          <div class="ui segment inverted red">
          <img class="ui center aligned image" style="width: 240px;padding: 30px 20px 30px 20px;" src="{% static "img/audioset_logo.svg" %}">
          </div>
        </div>
        <div class="right floated left aligned nine wide column">
          <h3 class="ui header">Title placeholder</h3>
          <p>The Audioset Ontology includes {{dataset.taxonomy.get_num_nodes}} classes. We have mapped a total of {{ dataset.num_sounds|intcomma }} Freesound.org audio
        samples to the AudioSet Ontology. The mapping generated {{ dataset.num_annotations|intcomma }} annotations
which express the potential presence of a sound source in an audio sample.</p>
        </div>
      </div>
    </div>
  </div>

<br><br>

<div class="ui grid">
<div class="eight wide column"><h2>Our goals</h2>
 <br>
 <div class="ui two statistics">
  <div class="grey statistic">
    <div class="value">
      +300k
    </div>
    <div class="label">
      audio samples
    </div>
  </div>
  <div class="grey statistic">
    <div class="text value">
      high <br>quality
    </div>
    <div class="label">
      annotations
    </div>
  </div>
 </div>
</div> 
<div class="eight wide column"><h2>Current status</h2>
 <br>
 <div class="ui two statistics">
  <div class="grey statistic">
    <div class="value">
      7%
    </div>
    <div class="label">
      completed
    </div>
  </div>
  <div class="grey statistic">
    <div class="value">
      1056
    </div>
    <div class="label">
      annotations
    </div>
  </div>
 </div>
</div> 
</div>

<br><br><br>

  <div class="ui container" style="width:80%;">
    <div class="ui middle aligned stackable grid container">
      <div class="row">
        <div class="right floated left aligned nine wide column">
          <h3 class="ui header">Space for examples and applications</h3>
          <p>We can give your company superpowers to do things that they never thought possible. Let us delight your customers and empower your needs...through pure data analytics.We can give your company superpowers to do things that they never thought possible. Let us delight your customers and empower your needs...through pure data analytics.</p>
        </div>
        <div class="six wide right floated column">
          <div class="ui segment inverted red">
          <img class="ui center aligned image" style="width: 240px;" src="{% static "img/freesound_logo.svg" %}">
          </div>
        </div>
      </div>
    </div>
  </div>


<br>

<h3> We are now crowdsourcing annotations to build the first {{ dataset.short_name|upper}} release</h3>

<div class="ui steps raised" style="text-align:left;">
  <div class="step">
    <i class="checkmark green icon"></i>
    <div class="content">
      <div class="title">Generate candidate<br>annotations</div>
      <div class="description">by leveraging Freesound.org </div>
    </div>
  </div>
  <div class="active step">
    <i class="users icon"></i>
    <div class="content">
      <div class="title">Crowdsourcing</div>
      <div class="description">we rely on the community to<br>verify the candidate annotations</div>
    </div>
  </div>
  <div class="disabled step">
    <i class="send icon"></i>
    <div class="content">
      <div class="title">First FSD release</div>
      <div class="description">including: waveforms, pre-computed<br>features, metadata and annotations</div>
    </div>
  </div>
</div>

<br>

<h2> Get involved and start contributing!</h2>
<div class="ui raised center aligned container" style="margin-top: 35px;">
<div class="ui basic buttons">

  <a class="ui button" href="{% url 'dataset-explore' dataset.short_name %}" style="min-width: 200px;">
      <center><i class="treatment open outline icon huge"></i>
      <h3>Explore</h3></center>
    </a>
  <a class="ui button" href="{% url 'contribute' dataset.short_name %}" style="min-width: 200px;">
      <center><i class="child icon huge"></i>
      <h3>Annotate</h3></center>
    </a>
  <a class="ui button" href="{% url 'discussion' dataset.short_name %}" style="min-width: 200px;">
      <center><i class="comments outline icon huge"></i>
      <h3>Discussion</h3></center>
    </a>
</div>
</div>
</center>





<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<div class="ui inverted red segment raised">
  <center><br><img class="ui center aligned image" style="width: 240px;padding: 30px 20px 30px 20px;" src="{% static "img/audioset_logo.svg" %}"><i class="ui icon heart big"><!-- heart handshake exchange --></i><img class="ui center aligned image" style="width: 240px;" src="{% static "img/freesound_logo.svg" %}"><i class="ui icon arrow down big"><!-- heart handshake exchange --></i><!--<img class="ui center aligned image" style="width: 270px;" src="{% static "img/freesound_datasets_logo.svg" %}">-->
<div class="ui raised segment" style="width:85%;margin-bottom:15px;">
<h3>The {{ dataset.name }} ({{ dataset.short_name|upper }}) is a large-scale, general-purpose audio dataset</h3>
        <h4 style="margin-top:0px">It consists of audio samples from <a target="_blank" href="http://freesound.org/">Freesound.org</a> (>300k) organised following the <a target="_blank" href="https://research.google.com/audioset/">AudioSet Ontology</a></h4>
</div>
</center>
</div>
<br>
<center>
<h2> We are now crowdsourcing annotations to build the first {{ dataset.short_name|upper}} release!</h2>

<div class="ui steps raised" style="text-align:left;">
  <div class="step">
    <i class="checkmark green icon"></i>
    <div class="content">
      <div class="title">Generate candidate<br>annotations</div>
      <div class="description">...via leveraging Freesound.org</div>
    </div>
  </div>
  <div class="active step">
    <i class="users icon"></i>
    <div class="content">
      <div class="title">Crowdsourcing</div>
      <div class="description">we rely on the community to<br>validate the candidate annotations!</div>
    </div>
  </div>
  <div class="disabled step">
    <i class="send icon"></i>
    <div class="content">
      <div class="title">First FSD release</div>
      <div class="description">including: waveforms, pre-computed<br>features, metadata and annotations</div>
    </div>
  </div>
</div>

<h2>Current status &ndash; statistics:</h2>
</center>
    <p>
        <div id="dataset_releases_table_placeholder">
            <div class="ui active centered inline text loader">Loading data...</div>
        </div>
    </p>
    {% if user_is_maintainer %}
        <button onclick="$('#make_release_modal').modal('show');" class="green ui button right labeled icon right floated">Make new release <i class="add icon"></i></button>
        <!-- make release modal -->
            <div id="make_release_modal" class="ui modal">
                <div class="header">
                    Make a new release for {{ dataset.name }}
                </div>
                <div class="content">
                    <form id="make_release_form" class="ui form" method="post" action=".">{% csrf_token %}
                        {{ dataset_release_form.as_p }}
                        <p><button class="right floated ui green button" type="submit">OK</button><br></p>
                    </form>
                </div>
            </div>
        <!-- end make release modal -->
    {% endif %}

<center>
<div class="ui segment" style="width:100%">
<p>Considering Freesound tags, we have mapped {{ dataset.num_sounds|intcomma }}
        audio samples to the AudioSet Ontology classes. As a result, the mapping generated {{ dataset.num_annotations|intcomma }} candidate annotations. 
        We are now validating these automatically generated candidate annotations via crowdsourcing &mdash; to publish soon the first FSD release!</p>
</div>

<h2> Get involved and start contributing!</h2>
<div class="ui raised center aligned container" style="margin-top: 35px;">
<div class="ui basic buttons">

  <a class="ui button" href="{% url 'dataset-explore' dataset.short_name %}" style="min-width: 200px;">
      <center><i class="treatment open outline icon huge"></i>
      <h3>Explore</h3></center>
    </a>
  <a class="ui button" href="{% url 'contribute' dataset.short_name %}" style="min-width: 200px;">
      <center><i class="child icon huge"></i>
      <h3>Annotate</h3></center>
    </a>
  <a class="ui button" href="{% url 'discussion' dataset.short_name %}" style="min-width: 200px;">
      <center><i class="comments outline icon huge"></i>
      <h3>Discussion</h3></center>
    </a>
  <a target="_blank" class="ui button" href="https://ismir2017.smcnus.org/wp-content/uploads/2017/10/161_Paper.pdf" style="min-width: 200px;">
      <center><i class="file pdf outline icon huge"></i>
      <h3>+ info</h3></center>
    </a>
</div>
</div>

<br>

<h2> Our goals</h2>

<br>

<div class="ui three statistics">
  <div class="grey statistic">
    <div class="value">
      +300,000
    </div>
    <div class="label">
      audio samples
    </div>
  </div>
  <div class="grey statistic">
    <div class="label">
      IMPROVE in
    </div>
    <div class="text value">
      QUANTITY &<br>QUALITY
    </div>
  </div>
    <div class="grey statistic">
    <div class="text value">
      HUMAN<br>
      LABELLED
    </div>
    <div class="label">
      DATASET
    </div>
  </div>
</div>
</center>
{% endblock %}
